#!/bin/bash

#SBATCH -A CHM137
#SBATCH -p caar
#SBATCH -t 00:30:00
#SBATCH -N 8
#SBATCH --ntasks-per-node=4
#SBATCH --gpus-per-node=4
#SBATCH --gpu-bind=closest

module -t list

date

export OMP_NUM_THREADS=16

#export MPICH_OFI_NIC_VERBOSE=2
#export MPICH_UCX_VERBOSE=2
export MPICH_ENV_DISPLAY=1

#for count in 1 10 100 1000 10000 100000 1000000 10000000
for count in 1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192 16384 32768 65536 131072 262144 524288 1048576 2097152 4194304 8388608 16777216 33554432 67108864 134217728 268435456
do
srun -c16 Alltoall_CPU_spock $count 30 4
done
for count in 1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192 16384 32768 65536 131072 262144 524288 1048576 2097152 4194304 8388608 16777216 33554432 67108864 134217728 268435456
do
srun -c16 Alltoall_HIP_spock $count 30 4
done

date
